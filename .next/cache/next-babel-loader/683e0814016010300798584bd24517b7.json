{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport PaddingWrapper from 'components/PaddingWrapper';\nimport { HorizontalPaddingWrapper } from 'styles/pages/home';\nimport DefaultTemplate from 'templates/Default';\nimport Heading from 'components/Heading';\nimport ShadowBox from 'components/ShadowBox';\nimport * as Styles from 'styles/pages/carrinho'; // import products from 'mocks/products.json'\n\nimport { useStateContext } from 'context';\nimport QuantController from 'components/QuantController';\nimport priceHandler from 'utils/handlePrice';\nimport { FiHeart } from 'react-icons/fi';\nimport { CgCloseR } from 'react-icons/cg';\nimport GridWrapper from 'components/GridWrapper';\nimport ProductCard from 'components/ProductCard';\nimport Button from 'components/Button';\nimport Input from 'components/Input';\nimport { cepMask } from 'utils/masks';\nimport Link from 'components/Link';\nimport { useState, useEffect } from 'react';\nimport api from 'services/api';\nimport { initializeApollo } from 'utils/apollo';\nimport { getTierProducts } from 'graphql/queryes/produtos';\nimport Paragraph from 'components/Paragraph';\nimport { useCookies } from 'react-cookie';\nimport { useRouter } from 'next/router';\nimport { getCategorias } from 'graphql/queryes/categorias';\n\nconst Carrinho = ({\n  tier,\n  categorias = []\n}) => {\n  const {\n    server,\n    cart,\n    setCart\n  } = useStateContext();\n  const {\n    products,\n    total\n  } = cart;\n  const {\n    0: cep,\n    1: setCep\n  } = useState('');\n  const {\n    0: shippingPrice,\n    1: setShippingPrice\n  } = useState(0);\n  const {\n    0: cashBack,\n    1: setCashBack\n  } = useState(0);\n  const {\n    0: cashBackPercent,\n    1: setCashBackPercent\n  } = useState(0);\n  const {\n    0: cupom,\n    1: setCupom\n  } = useState('');\n  const [cookie, setCookie] = useCookies(['user']);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const router = useRouter();\n\n  const cupomCheck = async () => {\n    alert(cupom);\n    await api.get(`/cupom/${cupom}`).then(response => {\n      const {\n        desconto\n      } = response.data;\n      setCashBackPercent(desconto);\n    }).catch(err => {\n      console.log(err);\n      alert('Cumpom invÃ¡lido');\n    });\n  };\n\n  const handleAddQuant = position => {\n    const products = cart.products;\n    let total = 0; // console.log(products[position].quant)\n\n    products[position].quant = products[position].quant + 1;\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total: total\n    });\n  };\n\n  const handleSubQuant = position => {\n    const products = cart.products;\n    let total = 0;\n\n    if (products[position].quant === 1) {\n      return;\n    }\n\n    products[position].quant = products[position].quant - 1;\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total: total\n    });\n  };\n\n  const shippingCalculate = async () => {\n    if (cep.length < 8) {\n      alert('cep incompleto');\n      return;\n    }\n\n    await api.post('/shipping/calculate', {\n      cep,\n      products: products.map(product => ({\n        id: product.id,\n        quant: product.quant\n      }))\n    }).then(response => {\n      const {\n        data\n      } = response;\n      const sedexShipping = data.find(option => option.name === 'SEDEX');\n      setShippingPrice(Number(sedexShipping.price) / 2);\n    }).catch(err => {\n      alert('algo deu errado, por favor tente novamente');\n      console.log(err);\n    });\n  };\n\n  const handleDelete = position => {\n    let total = 0.0;\n    const products = cart.products.filter(product => product !== cart.products[position]);\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total: total\n    });\n  };\n\n  const cashBackCalculate = () => {\n    const discount = total / 100 * cashBackPercent;\n    setCashBack(discount);\n  };\n\n  useEffect(() => {\n    cashBackCalculate();\n  }, [cashBackPercent, total]); // useEffect(() => {\n  //   setCart({\n  //     products: [],\n  //     total: 0\n  //   })\n  // }, [])\n\n  if (!products[0]) {\n    return /*#__PURE__*/_jsx(DefaultTemplate, {\n      categorias: categorias,\n      children: /*#__PURE__*/_jsx(PaddingWrapper, {\n        children: /*#__PURE__*/_jsxs(HorizontalPaddingWrapper, {\n          children: [/*#__PURE__*/_jsx(Heading, {\n            children: \"Seu carrinho est\\xE1 vazio!\"\n          }), /*#__PURE__*/_jsx(HorizontalPaddingWrapper, {\n            children: /*#__PURE__*/_jsx(Paragraph, {\n              textAlign: \"center\",\n              children: \"Parece que voc\\xEA n\\xE3o tem nada em seu carrinho, aqui est\\xE3o algumas sujest\\xF5es\"\n            })\n          }), /*#__PURE__*/_jsx(HorizontalPaddingWrapper, {\n            children: /*#__PURE__*/_jsx(GridWrapper, {\n              children: tier.map((product, index) => /*#__PURE__*/_jsx(ProductCard, {\n                id: product.id,\n                name: product.nome,\n                image: server + product.cover.url,\n                price: product.preco,\n                slug: product.slug\n              }, index))\n            })\n          })]\n        })\n      })\n    });\n  }\n\n  const buy = async () => {\n    if (!cookie.token) {\n      router.push('/login');\n      return;\n    }\n\n    if (shippingPrice === 0) {\n      alert('por favor, insira seu cep e calcule seu frete');\n      return;\n    }\n\n    if (isLoading) {\n      return;\n    }\n\n    setIsLoading(true);\n    const order = await api.post('/pedido', {\n      cep,\n      cupom,\n      products: cart.products\n    }, {\n      headers: {\n        Authorization: `Bearer ${cookie.token}`\n      }\n    }).then(order => {\n      setCart({\n        products: [],\n        total: 0\n      });\n      setIsLoading(false);\n      router.push(order.data.url);\n    }).catch(err => {\n      alert('algo deu errado, por favor tente novamente');\n      setIsLoading(false);\n    });\n  };\n\n  return /*#__PURE__*/_jsx(DefaultTemplate, {\n    categorias: categorias,\n    children: /*#__PURE__*/_jsx(PaddingWrapper, {\n      children: /*#__PURE__*/_jsxs(HorizontalPaddingWrapper, {\n        children: [/*#__PURE__*/_jsx(Heading, {\n          margin: \"0 0 30px 0\",\n          children: \"MEU CARRINHO\"\n        }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.Main, {\n          children: [/*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.ShippingWrapper, {\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"header\",\n              children: [/*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"PRODUTO\"\n              }), /*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"QUANTIDADE\"\n              }), /*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"PRE\\xC7O UNITARIO\"\n              })]\n            }), /*#__PURE__*/_jsx(\"br\", {}), products.map((product, index) => /*#__PURE__*/_jsxs(ShadowBox, {\n              className: \"shipping-box\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"cell\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex variable\",\n                  children: [/*#__PURE__*/_jsx(Styles.ProductImage, {\n                    image: server + product.cover.url\n                  }), /*#__PURE__*/_jsxs(Styles.ProductData, {\n                    children: [/*#__PURE__*/_jsx(Styles.ProductName, {\n                      children: product.nome.toUpperCase()\n                    }), /*#__PURE__*/_jsxs(Styles.ProductReference, {\n                      children: [/*#__PURE__*/_jsx(\"b\", {\n                        children: \"refer\\xEAncia:\"\n                      }), \" \", product.slug]\n                    }), product.custom.isCustom && /*#__PURE__*/_jsxs(_Fragment, {\n                      children: [/*#__PURE__*/_jsxs(Styles.CustomName, {\n                        children: [/*#__PURE__*/_jsx(\"b\", {\n                          children: \"Nome:\"\n                        }), \" \", product.custom.name]\n                      }), /*#__PURE__*/_jsxs(Styles.CustomNumber, {\n                        children: [/*#__PURE__*/_jsx(\"b\", {\n                          children: \"N\\xFAmero:\"\n                        }), \" \", product.custom.number]\n                      })]\n                    }), /*#__PURE__*/_jsxs(Styles.CustomNumber, {\n                      children: [/*#__PURE__*/_jsx(\"b\", {\n                        children: \"Tamanho:\"\n                      }), \" \", product.size]\n                    }), /*#__PURE__*/_jsx(Styles.Favorite, {\n                      children: /*#__PURE__*/_jsx(FiHeart, {})\n                    })]\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"cell\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"flex align-center\",\n                  children: /*#__PURE__*/_jsx(QuantController, {\n                    handleAdd: () => {\n                      handleAddQuant(index);\n                    },\n                    handleSub: () => {\n                      handleSubQuant(index);\n                    },\n                    quant: product.quant\n                  })\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"cell\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex align-center\",\n                  children: [/*#__PURE__*/_jsx(Styles.ProductPrice, {\n                    children: priceHandler.priceNumberToReadblePrice(product.preco)\n                  }), \"\\xA0 \\xA0\", /*#__PURE__*/_jsx(CgCloseR, {\n                    onClick: () => {\n                      handleDelete(index);\n                    },\n                    color: \"red\",\n                    size: 20\n                  })]\n                })\n              })]\n            }, index))]\n          }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.OrderResume, {\n            children: [/*#__PURE__*/_jsx(Heading, {\n              role: \"h4\",\n              lineBottom: false,\n              color: \"white100\",\n              children: \"RESUMO DO PEDIDO\"\n            }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"SUBTOTAL\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"main-price\",\n                children: priceHandler.priceNumberToReadblePrice(total)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"ENTREGA\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"shipping-price\",\n                children: shippingPrice === 0 ? 'Insira seu cep e calcule o envio' : priceHandler.priceNumberToReadblePrice(shippingPrice)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"DESCONTO\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"shipping-price\",\n                children: cashBack === 0 ? 'Insira seu cupom de desconto' : priceHandler.priceNumberToReadblePrice(cashBack)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"TOTAL\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"total\",\n                children: priceHandler.priceNumberToReadblePrice(total - cashBack + shippingPrice)\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"shipping-and-cupom\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"shipping\",\n              children: /*#__PURE__*/_jsx(ShadowBox, {\n                paddingX: \"xsmall\",\n                paddingY: \"medium\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"space-between-variable\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    children: [/*#__PURE__*/_jsx(\"h3\", {\n                      className: \"xxlarge semiBold\",\n                      children: \"CALCULE FRETE E PRAZO\"\n                    }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(Link, {\n                      href: \"http://www.buscacep.correios.com.br/sistemas/buscacep/buscaCepEndereco.cfm\",\n                      target: \"_blank\",\n                      fontSize: \"xlarge\",\n                      children: \"N\\xE3o sei meu cep\"\n                    })]\n                  }), \"\\xA0\", /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"start cep-input-wrapper\",\n                    children: [/*#__PURE__*/_jsx(Input, {\n                      value: cep,\n                      onChange: e => setCep(cepMask(e.target.value)),\n                      height: 50,\n                      width: 200,\n                      maxLength: 8,\n                      placeholder: \"MEU CEP\"\n                    }), /*#__PURE__*/_jsx(Button, {\n                      fontSize: \"xlarge\",\n                      onClick: shippingCalculate,\n                      children: \"OK\"\n                    })]\n                  })]\n                })\n              })\n            }), \"\\xA0\", /*#__PURE__*/_jsxs(ShadowBox, {\n              className: \"cupom-wrapper\",\n              children: [/*#__PURE__*/_jsx(Heading, {\n                role: \"h4\",\n                fontSize: \"large\",\n                lineBottom: false,\n                children: \"CUPOM DE DESCONTO\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"cupom-input-wrapper\",\n                children: [/*#__PURE__*/_jsx(Input, {\n                  value: cupom,\n                  onChange: e => setCupom(e.target.value),\n                  placeholder: \"MEU CUPOM\"\n                }), ' ', /*#__PURE__*/_jsx(Button, {\n                  onClick: cupomCheck,\n                  children: \"OK\"\n                })]\n              })]\n            }), /*#__PURE__*/_jsx(Button, {\n              className: \"buy-button\",\n              fill: \"red100\",\n              radius: 10,\n              onClick: buy,\n              children: isLoading ? 'Processando...' : 'Finalizar compra'\n            })]\n          }), /*#__PURE__*/_jsx(Heading, {\n            role: \"h2\",\n            lineBottom: false,\n            fontSize: \"xxxlarge\",\n            margin: \"50px 0\",\n            fontWeight: \"bold\",\n            children: \"COMPRE TAMB\\xC9M\"\n          }), /*#__PURE__*/_jsx(GridWrapper, {\n            children: tier.map((product, index) => /*#__PURE__*/_jsx(ProductCard, {\n              id: product.id,\n              name: product.nome,\n              image: server + product.cover.url,\n              price: product.preco,\n              slug: product.slug\n            }, index))\n          })]\n        })]\n      })\n    })\n  });\n};\n\nexport const getStaticProps = async () => {\n  const client = initializeApollo();\n  const {\n    data\n  } = await client.query({\n    query: getTierProducts\n  });\n  const tierList = data.destaque.produtos.map(produto => produto.produto);\n  const response = await client.query({\n    query: getCategorias\n  });\n  const {\n    categorias\n  } = response.data;\n  return {\n    props: {\n      tier: data.destaque.produtos.map(produto => produto.produto),\n      categorias\n    },\n    revalidate: 60\n  };\n};\nexport default Carrinho;","map":null,"metadata":{},"sourceType":"module"}