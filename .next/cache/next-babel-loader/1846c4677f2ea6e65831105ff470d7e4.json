{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useEffect } from 'react';\nimport DefaultTemplate from 'templates/Default';\nimport PaymentBanner from 'components/PaymentsBanner';\nimport productsMock from 'mocks/products.json';\nimport Heading from 'components/Heading';\nimport PaddingWrapper from 'components/PaddingWrapper';\nimport GridWrapper from 'components/GridWrapper';\nimport ProductCard from 'components/ProductCard';\nimport Input from 'components/Input';\nimport { MdKeyboardArrowDown } from 'react-icons/md';\nimport { DescriptionWrapper, ProductSection, ProductAside, ProductReference, ProductPrice, ProductInstallments, QuantTitle, SizesWrapper, PersonalizationButtonSelector, PersonalizationInput, PersonalizationInputsWrapper, SizeButton, Add2Favorites, MiniCartWrapper } from 'styles/pages/produto';\nimport { FiHeart } from 'react-icons/fi';\nimport { FaHeart } from 'react-icons/fa';\nimport { useStateContext } from 'context';\nimport ProductGalery from 'components/ProductGalery';\nimport { HorizontalPaddingWrapper } from 'styles/pages/home';\nimport priceHandler from 'utils/handlePrice';\nimport QuantController from 'components/QuantController';\nimport Button from 'components/Button';\nimport { cepMask } from 'utils/masks';\nimport { getAllProducts, getProductBySlug } from 'graphql/queryes/produtos';\nimport { getCategorias } from 'graphql/queryes/categorias';\nimport { initializeApollo } from 'utils/apollo';\nimport { useCookies } from 'react-cookie';\nimport api from 'services/api';\nimport SuccessAddPopUp from 'components/SuccessAddPopUp';\nimport MiniCart from 'components/MiniCart';\nimport Head from 'next/head';\n\nconst Produto = ({\n  product,\n  categorias\n}) => {\n  var _tamanho$adulto, _tamanho$adulto2, _tamanho$adulto3, _tamanho$adulto4;\n\n  console.log(product === null || product === void 0 ? void 0 : product.id);\n  const {\n    id,\n    resumo,\n    nome,\n    preco,\n    descricao,\n    cover,\n    marca,\n    galeria,\n    slug,\n    kid,\n    tamanho\n  } = product; //console.log(resumo)\n  //console.log(product.resumo)\n  //console.log(product)\n\n  const {\n    server\n  } = useStateContext();\n  const {\n    0: quant,\n    1: setQuant\n  } = useState(1);\n  const {\n    0: cep,\n    1: setCep\n  } = useState('');\n  const {\n    0: size,\n    1: setSize\n  } = useState('');\n  const {\n    0: personalization,\n    1: setPersonalization\n  } = useState({\n    isCustom: false,\n    name: '',\n    number: ''\n  });\n  const {\n    0: shippingOptions,\n    1: setShippingOptions\n  } = useState([]);\n  const {\n    0: showUnauthorized,\n    1: setShowUnauthorized\n  } = useState(false);\n  const {\n    0: showSuccess,\n    1: setShowSuccess\n  } = useState(false);\n  const {\n    cart,\n    setCart\n  } = useStateContext(); // const [isFavorite, setIsFavorite] = useState(false)\n\n  const [cookie, setCookie] = useCookies(['user']);\n  const {\n    0: showMiniCart,\n    1: setShowMiniCart\n  } = useState(false);\n  useEffect(() => {\n    // alert('Aloohhh')\n    if (cep.length === 8) {\n      shippingCalculate();\n    }\n\n    setQuant(1);\n    setSize('');\n  }, [slug]);\n\n  if (!product) {\n    return /*#__PURE__*/_jsx(_Fragment, {\n      children: \"Pagina inv\\xE1lida\"\n    });\n  }\n\n  const shippingCalculate = async () => {\n    if (cep.length < 8) {\n      alert('cep incompleto');\n      return;\n    }\n\n    await api.post('/shipping/calculate', {\n      cep,\n      products: [{\n        id: product.id,\n        quant\n      }]\n    }).then(response => {\n      const {\n        data\n      } = response;\n      const sedexShipping = data.find(option => option.name === 'SEDEX');\n      setShippingOptions([sedexShipping]);\n    }).catch(err => {\n      alert('algo deu errado, por favor tente novamente'); //console.log(err)\n    });\n  };\n\n  const handleAddQuant = () => {\n    setQuant(quant + 1);\n  };\n\n  const handleSubQuant = () => {\n    setQuant(quant - 1);\n  };\n\n  const addToCart = () => {\n    if (size === '') {\n      alert('Por favor selecione o tamanho desejado');\n      return;\n    }\n\n    const product = {\n      id,\n      nome,\n      preco,\n      descricao,\n      cover,\n      slug,\n      size,\n      custom: {\n        isCustom: personalization.isCustom,\n        name: personalization.name,\n        number: personalization.number\n      },\n      quant\n    }; // //console.log(product)\n\n    const products = [...cart.products, product];\n    let total = 0.0;\n    products === null || products === void 0 ? void 0 : products.map(item => {\n      total = total + item.preco * item.quant;\n    });\n    setCart({\n      products,\n      total\n    });\n    setShowMiniCart(true); // alert('produto adicionado')\n  };\n\n  const checkIsFavorite = () => {\n    let isFavorite = false;\n\n    if (!cookie.token) {\n      return;\n    }\n\n    const {\n      favorites\n    } = cookie.user;\n\n    if (!favorites) {\n      return;\n    }\n\n    favorites.map(productId => {\n      //console.log(productId, id)\n      if (productId == id) {\n        isFavorite = true;\n      }\n    });\n    return isFavorite;\n  };\n\n  const favorite = async () => {\n    if (!cookie.token) {\n      setShowUnauthorized(true);\n      return;\n    }\n\n    if (!checkIsFavorite()) {\n      const data = {\n        produtos: [...cookie.user.favorites, id]\n      };\n      await api.put('/favoritos', data, {\n        headers: {\n          Authorization: `Bearer ${cookie.token}`\n        }\n      }).then(() => {\n        setShowSuccess(true);\n        setCookie('user', _objectSpread(_objectSpread({}, cookie.user), {}, {\n          favorites: [...cookie.user.favorites, id]\n        }));\n      }).catch(err => console.log(err));\n      return;\n    } else {\n      const data = {\n        produtos: cookie.user.favorites.filter(productId => productId != id)\n      }; //console.log(data)\n\n      await api.put('/favoritos', data, {\n        headers: {\n          Authorization: `Bearer ${cookie.token}`\n        }\n      }).then(() => {\n        alert('produto excluido da sua lista de favoritos');\n        setCookie('user', _objectSpread(_objectSpread({}, cookie.user), {}, {\n          favorites: cookie.user.favorites.filter(productId => productId != id)\n        }));\n      }).catch(err => console.log(err));\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"title\", {\n        children: product.nome\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:title\",\n        content: product.nome\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        name: \"description\",\n        content: product.resumo\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:description\",\n        content: product.resumo\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:image\",\n        content: process.env.NEXT_PUBLIC_SERVER_HOST || 'localhost:1337' + product.cover\n      })]\n    }), /*#__PURE__*/_jsx(SuccessAddPopUp, {\n      show: showSuccess,\n      onClose: () => setShowSuccess(false)\n    }), /*#__PURE__*/_jsx(MiniCartWrapper, {\n      show: showMiniCart,\n      children: /*#__PURE__*/_jsx(MiniCart, {\n        onClose: () => {\n          setShowMiniCart(false);\n        }\n      })\n    }), /*#__PURE__*/_jsxs(DefaultTemplate, {\n      categorias: categorias,\n      children: [/*#__PURE__*/_jsx(PaymentBanner, {}), /*#__PURE__*/_jsxs(PaddingWrapper, {\n        children: [/*#__PURE__*/_jsx(HorizontalPaddingWrapper, {\n          children: /*#__PURE__*/_jsxs(ProductSection, {\n            children: [/*#__PURE__*/_jsx(ProductGalery, {\n              images: galeria\n            }), /*#__PURE__*/_jsxs(ProductAside, {\n              children: [/*#__PURE__*/_jsx(Heading, {\n                lineBottom: false,\n                fontSize: \"xxxlarge\",\n                fontWeight: \"bold\",\n                textAlign: \"left\",\n                margin: \"0 0 10px 0\",\n                children: nome === null || nome === void 0 ? void 0 : nome.toUpperCase()\n              }), /*#__PURE__*/_jsxs(ProductReference, {\n                children: [/*#__PURE__*/_jsx(\"b\", {\n                  children: \"Referencia:\"\n                }), \" \", slug]\n              }), /*#__PURE__*/_jsx(Add2Favorites, {\n                onClick: favorite,\n                children: checkIsFavorite() ? /*#__PURE__*/_jsxs(_Fragment, {\n                  children: [/*#__PURE__*/_jsx(FaHeart, {}), \" \\xA0 Remover dos favoritos\"]\n                }) : /*#__PURE__*/_jsxs(_Fragment, {\n                  children: [/*#__PURE__*/_jsx(FiHeart, {}), \" \\xA0 Adicionar aos favoritos\"]\n                })\n              }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsx(ProductPrice, {\n                children: priceHandler.priceNumberToReadblePrice(preco)\n              }), /*#__PURE__*/_jsx(ProductInstallments, {\n                children: `ou entÃ£o 3x de ${priceHandler.priceNumberToReadblePrice(preco / 3)}`\n              }), /*#__PURE__*/_jsx(QuantTitle, {\n                children: \"Quantidade\"\n              }), /*#__PURE__*/_jsx(QuantController, {\n                handleAdd: handleAddQuant,\n                handleSub: handleSubQuant,\n                quant: quant\n              }), /*#__PURE__*/_jsx(Button, {\n                onClick: addToCart,\n                className: \"add2cart\",\n                fill: \"red100\",\n                radius: 50,\n                children: \"ADD CARRINHO\"\n              }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(PersonalizationButtonSelector, {\n                onClick: () => setPersonalization(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n                  isCustom: !personalization.isCustom\n                })),\n                children: [\"PERSONALIZA\\xC7\\xC3O \\xA0 \", /*#__PURE__*/_jsx(MdKeyboardArrowDown, {})]\n              }), personalization.isCustom && /*#__PURE__*/_jsxs(PersonalizationInputsWrapper, {\n                children: [/*#__PURE__*/_jsx(PersonalizationInput, {\n                  width: 180,\n                  placeholder: \"NOME\",\n                  value: personalization.name,\n                  onChange: e => setPersonalization(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n                    name: e.target.value\n                  }))\n                }), /*#__PURE__*/_jsx(PersonalizationInput, {\n                  width: 100,\n                  maxLength: 2,\n                  placeholder: \"N\\xDAMERO\",\n                  value: personalization.number,\n                  onChange: e => setPersonalization(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n                    number: e.target.value\n                  }))\n                })]\n              }), /*#__PURE__*/_jsx(SizesWrapper, {\n                children: kid ? /*#__PURE__*/_jsx(\"div\", {\n                  children: \"tamanho crian\\xE7a\"\n                }) : /*#__PURE__*/_jsxs(_Fragment, {\n                  children: [(tamanho === null || tamanho === void 0 ? void 0 : (_tamanho$adulto = tamanho.adulto) === null || _tamanho$adulto === void 0 ? void 0 : _tamanho$adulto.P) && /*#__PURE__*/_jsx(SizeButton, {\n                    selected: size === 'P' && true,\n                    className: \"size-button\",\n                    onClick: () => {\n                      setSize('P');\n                    },\n                    color: size === 'M' ? 'white100' : 'black',\n                    children: \"P\"\n                  }), (tamanho === null || tamanho === void 0 ? void 0 : (_tamanho$adulto2 = tamanho.adulto) === null || _tamanho$adulto2 === void 0 ? void 0 : _tamanho$adulto2.M) && /*#__PURE__*/_jsx(SizeButton, {\n                    selected: size === 'M' && true,\n                    className: \"size-button\",\n                    onClick: () => {\n                      setSize('M');\n                    },\n                    color: size === 'M' ? 'white100' : 'black',\n                    children: \"M\"\n                  }), (tamanho === null || tamanho === void 0 ? void 0 : (_tamanho$adulto3 = tamanho.adulto) === null || _tamanho$adulto3 === void 0 ? void 0 : _tamanho$adulto3.G) && /*#__PURE__*/_jsx(SizeButton, {\n                    selected: size === 'G' && true,\n                    className: \"size-button\",\n                    onClick: () => {\n                      setSize('G');\n                    },\n                    color: size === 'M' ? 'white100' : 'black',\n                    children: \"G\"\n                  }), (tamanho === null || tamanho === void 0 ? void 0 : (_tamanho$adulto4 = tamanho.adulto) === null || _tamanho$adulto4 === void 0 ? void 0 : _tamanho$adulto4.GG) && /*#__PURE__*/_jsx(SizeButton, {\n                    selected: size === 'GG' && true,\n                    className: \"size-button\",\n                    onClick: () => {\n                      setSize('GG');\n                    },\n                    color: size === 'GG' ? 'white100' : 'black',\n                    children: \"GG\"\n                  })]\n                })\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"shipping-wrapper\",\n                children: [/*#__PURE__*/_jsx(\"h3\", {\n                  children: \"Calcular frete e prazo\"\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"cep-input-wrapper\",\n                  children: [/*#__PURE__*/_jsx(Input, {\n                    placeholder: \"00000-000\",\n                    type: \"text\",\n                    maxLength: 8,\n                    borderColor: \"gray100\",\n                    borderWidth: 1,\n                    value: cep,\n                    fontSize: \"xlarge\",\n                    onChange: e => setCep(cepMask(e.target.value))\n                  }), /*#__PURE__*/_jsx(Button, {\n                    onClick: shippingCalculate,\n                    children: \"OK\"\n                  })]\n                }), shippingOptions[0] && /*#__PURE__*/_jsxs(_Fragment, {\n                  children: [/*#__PURE__*/_jsxs(\"table\", {\n                    className: shippingOptions[0] ? '' : 'hidden',\n                    children: [/*#__PURE__*/_jsxs(\"tr\", {\n                      children: [/*#__PURE__*/_jsx(\"th\", {\n                        children: \"Entrega \"\n                      }), /*#__PURE__*/_jsx(\"th\", {\n                        children: \"Frete\"\n                      }), /*#__PURE__*/_jsx(\"th\", {\n                        children: \"Prazo\"\n                      })]\n                    }), shippingOptions === null || shippingOptions === void 0 ? void 0 : shippingOptions.map(option => /*#__PURE__*/_jsxs(\"tr\", {\n                      children: [/*#__PURE__*/_jsxs(\"td\", {\n                        children: [option === null || option === void 0 ? void 0 : option.name, \" \"]\n                      }), /*#__PURE__*/_jsxs(\"td\", {\n                        children: [priceHandler.priceNumberToReadblePrice(Number((option === null || option === void 0 ? void 0 : option.price) / 2)), ' ']\n                      }), /*#__PURE__*/_jsxs(\"td\", {\n                        children: [`15 dias(s)`, \" \"]\n                      })]\n                    }, option === null || option === void 0 ? void 0 : option.id))]\n                  }), /*#__PURE__*/_jsx(\"span\", {\n                    className: \"disclaimer\",\n                    children: \"* Este prazo de entrega est\\xE1 considerando a encomenda do produto + prazo de entrega.\"\n                  })]\n                })]\n              })]\n            })]\n          })\n        }), /*#__PURE__*/_jsx(Heading, {\n          role: \"h2\",\n          lineBottom: false,\n          fontSize: \"xxxlarge\",\n          margin: \"50px 0\",\n          children: \"QUEM VIU ESTE PRODUTO, VIU TAMB\\xC9M\"\n        }), /*#__PURE__*/_jsx(GridWrapper, {\n          children: productsMock === null || productsMock === void 0 ? void 0 : productsMock.map((product, index) => /*#__PURE__*/_jsx(ProductCard, {\n            id: product.id,\n            name: product.nome,\n            image: server + product.cover.url,\n            price: product.preco,\n            slug: product.slug\n          }, index))\n        }), /*#__PURE__*/_jsx(Heading, {\n          role: \"h2\",\n          margin: \"50px 0 0 0\",\n          fontSize: \"extra\",\n          children: \"DESCRI\\xC7\\xC3O\"\n        }), /*#__PURE__*/_jsx(DescriptionWrapper, {\n          dangerouslySetInnerHTML: {\n            __html: descricao\n          }\n        })]\n      })]\n    })]\n  });\n};\n\nexport const getStaticPaths = async () => {\n  const client = initializeApollo();\n  const response = await client.query({\n    query: getAllProducts\n  });\n  const {\n    products\n  } = response === null || response === void 0 ? void 0 : response.data;\n  return {\n    paths: products === null || products === void 0 ? void 0 : products.map(product => {\n      return {\n        params: {\n          slug: product.slug\n        }\n      };\n    }),\n    fallback: true\n  };\n};\nexport const getStaticProps = async ({\n  params\n}) => {\n  // //console.log(params)\n  // if (!params?.slug) {\n  //   return {\n  //     redirect: {\n  //       destination: '/',\n  //       permanent: false\n  //     }\n  //   }\n  // }\n  const slug = params === null || params === void 0 ? void 0 : params.slug; // const product = productsMock.find((product) => product.slug === slug)\n\n  const client = initializeApollo();\n  const productResponse = await client.query({\n    query: getProductBySlug,\n    variables: {\n      slug\n    }\n  });\n  const categoriesResponse = await client.query({\n    query: getCategorias\n  });\n  const {\n    produtos\n  } = productResponse.data;\n  const {\n    categorias\n  } = categoriesResponse.data; //console.log(produtos[0])\n\n  return {\n    props: {\n      product: produtos[0],\n      categorias\n    },\n    revalidate: 60\n  };\n};\nexport default Produto;","map":null,"metadata":{},"sourceType":"module"}