{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport Paragraph from 'components/Paragraph';\nimport * as S from './styles';\nimport { MdKeyboardArrowLeft } from 'react-icons/md';\nimport { CgCloseO } from 'react-icons/cg';\nimport Heading from 'components/Heading';\nimport { FiMinusCircle, FiPlusCircle } from 'react-icons/fi';\nimport { useState, useEffect } from 'react';\nimport Input from 'components/Input';\nimport Button from 'components/Button';\nimport Link from 'next/link';\nimport { useStateContext } from 'context';\nimport handlePrice from 'utils/handlePrice';\nimport PriceHandler from 'utils/handlePrice';\nimport api from 'services/api';\n\nconst MiniCart = ({\n  onClose\n}) => {\n  const {\n    cart,\n    setCart,\n    server\n  } = useStateContext();\n  const {\n    0: cupom,\n    1: setCupom\n  } = useState('');\n  const {\n    0: cashBackPercent,\n    1: setCashBackPercent\n  } = useState(0);\n  const {\n    0: cashBack,\n    1: setCashBack\n  } = useState(0);\n\n  const handleDelete = position => {\n    let total = 0.0;\n    const products = cart.products.filter(product => product !== cart.products[position]);\n    console.log(products);\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total\n    });\n  };\n\n  const cupomCheck = async () => {\n    await api.get(`/cupom/${cupom}`).then(response => {\n      const {\n        desconto\n      } = response.data;\n      setCashBackPercent(desconto);\n    }).catch(err => {\n      console.log(err);\n      alert('Cumpom invÃ¡lido');\n    });\n  };\n\n  const cashBackCalculate = () => {\n    const total = cart.total;\n    const discount = total / 100 * cashBackPercent; // discount = total * cashBackPercent\n\n    setCashBack(discount);\n  };\n\n  useEffect(() => {\n    cashBackCalculate();\n  }, [cart, cashBackPercent]);\n\n  const handleAdd = position => {\n    const products = cart.products;\n    let total = 0;\n    products[position].quant = products[position].quant + 1;\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total\n    });\n  };\n\n  const handleSub = position => {\n    const products = cart.products;\n    let total = 0;\n\n    if (products[position].quant === 1) {\n      return;\n    }\n\n    products[position].quant = products[position].quant - 1;\n    products.map(product => {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products,\n      total\n    });\n  };\n\n  useEffect(() => {\n    if (cart.total === 0) {\n      onClose();\n    }\n  }, [cart]);\n  return /*#__PURE__*/_jsxs(S.Wrapper, {\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"close\",\n      children: /*#__PURE__*/_jsx(MdKeyboardArrowLeft, {\n        onClick: onClose\n      })\n    }), /*#__PURE__*/_jsx(Paragraph, {\n      color: \"black\",\n      fontSize: \"small\",\n      font: \"ubuntu\",\n      fontWeight: \"semiBold\",\n      justify: \"center\",\n      textAlign: \"center\",\n      children: \"ITENS ADICIONADOS NO CARRINHO DE COMPRAS\"\n    }), /*#__PURE__*/_jsxs(S.Header, {\n      children: [/*#__PURE__*/_jsx(Paragraph, {\n        color: \"gray300\",\n        fontSize: \"medium\",\n        font: \"ubuntu\",\n        justify: \"center\",\n        textAlign: \"center\",\n        children: \"Produto\"\n      }), /*#__PURE__*/_jsx(Paragraph, {\n        color: \"gray300\",\n        fontSize: \"medium\",\n        font: \"ubuntu\",\n        justify: \"center\",\n        textAlign: \"center\",\n        children: \"Pre\\xE7o Un\\xEDtario\"\n      }), /*#__PURE__*/_jsx(Paragraph, {\n        color: \"gray300\",\n        fontSize: \"medium\",\n        font: \"ubuntu\",\n        justify: \"center\",\n        textAlign: \"center\",\n        children: \"Quantidade\"\n      }), /*#__PURE__*/_jsx(\"div\", {})]\n    }), /*#__PURE__*/_jsx(S.ProductsList, {\n      children: cart.products.map((product, index) => /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"product cell\",\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: server + product.cover.url,\n            alt: product.nome,\n            className: \"product-image\"\n          }), /*#__PURE__*/_jsx(Paragraph, {\n            color: \"black\",\n            fontWeight: \"bold\",\n            fontSize: \"large\",\n            justify: \"center\",\n            textAlign: \"center\",\n            children: product.nome\n          }), /*#__PURE__*/_jsxs(Paragraph, {\n            color: \"black\",\n            font: \"ubuntu\",\n            fontSize: \"xsmall\",\n            justify: \"center\",\n            textAlign: \"center\",\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: \"Refer\\xEAncia:\"\n            }), \" \", product.slug]\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"price cell\",\n          children: /*#__PURE__*/_jsx(Heading, {\n            fontSize: \"xlarge\",\n            role: \"h4\",\n            lineBottom: false,\n            margin: \"0\",\n            justify: \"center\",\n            children: handlePrice.priceNumberToReadblePrice(product.preco)\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"quant cell\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"quant-controller\",\n            children: [/*#__PURE__*/_jsx(FiMinusCircle, {\n              onClick: () => {\n                handleSub(index);\n              }\n            }), product.quant, /*#__PURE__*/_jsx(FiPlusCircle, {\n              onClick: () => {\n                handleAdd(index);\n              }\n            })]\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"erase cell\",\n          children: /*#__PURE__*/_jsx(CgCloseO, {\n            onClick: () => {\n              handleDelete(index);\n            }\n          })\n        })]\n      }))\n    }), /*#__PURE__*/_jsxs(S.VoucherContainer, {\n      children: [/*#__PURE__*/_jsx(Paragraph, {\n        color: \"black\",\n        fontSize: \"large\",\n        fontWeight: \"semiBold\",\n        children: \"CUPOM DE DESCONTO\"\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"input-container\",\n        children: [/*#__PURE__*/_jsx(Input, {\n          value: cupom,\n          onChange: e => setCupom(e.target.value.toUpperCase())\n        }), \"\\xA0\", /*#__PURE__*/_jsx(Button, {\n          fill: \"brown\",\n          onClick: cupomCheck,\n          children: \"OK\"\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(S.SubTotal, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        children: [\"Subtotal:\", ' ', /*#__PURE__*/_jsx(\"strong\", {\n          children: PriceHandler.priceNumberToReadblePrice(cart.total - cashBack)\n        })]\n      })\n    }), /*#__PURE__*/_jsxs(S.BuyOrView, {\n      children: [/*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsx(Link, {\n        href: \"/carrinho\",\n        passHref: true,\n        children: /*#__PURE__*/_jsx(\"a\", {\n          children: /*#__PURE__*/_jsx(Button, {\n            fill: \"red100\",\n            fontSize: \"large\",\n            children: \"FINALIZAR COMPRA\"\n          })\n        })\n      })]\n    })]\n  });\n};\n\nexport default MiniCart;","map":null,"metadata":{},"sourceType":"module"}