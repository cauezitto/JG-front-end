{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport PaddingWrapper from 'components/PaddingWrapper';\nimport { HorizontalPaddingWrapper } from 'styles/pages/home';\nimport DefaultTemplate from 'templates/Default';\nimport Heading from 'components/Heading';\nimport ShadowBox from 'components/ShadowBox';\nimport * as Styles from 'styles/pages/carrinho'; // import products from 'mocks/products.json'\n\nimport { useStateContext } from 'context';\nimport QuantController from 'components/QuantController';\nimport priceHandler from 'utils/handlePrice';\nimport { FiHeart } from 'react-icons/fi';\nimport { CgCloseR } from 'react-icons/cg';\nimport GridWrapper from 'components/GridWrapper';\nimport ProductCard from 'components/ProductCard';\nimport Button from 'components/Button';\nimport Input from 'components/Input';\nimport { cepMask } from 'utils/masks';\nimport Link from 'components/Link';\nimport { useState, useEffect } from 'react';\nimport api from 'services/api';\nimport Paragraph from 'components/Paragraph';\nimport { useCookies } from 'react-cookie';\nimport { useRouter } from 'next/router';\n\nvar Carrinho = function Carrinho(_ref) {\n  var tier = _ref.tier,\n      _ref$categorias = _ref.categorias,\n      categorias = _ref$categorias === void 0 ? [] : _ref$categorias;\n\n  var _useStateContext = useStateContext(),\n      server = _useStateContext.server,\n      cart = _useStateContext.cart,\n      setCart = _useStateContext.setCart;\n\n  var products = cart.products,\n      total = cart.total;\n\n  var _useState = useState(''),\n      cep = _useState[0],\n      setCep = _useState[1];\n\n  var _useState2 = useState(0),\n      shippingPrice = _useState2[0],\n      setShippingPrice = _useState2[1];\n\n  var _useState3 = useState(0),\n      cashBack = _useState3[0],\n      setCashBack = _useState3[1];\n\n  var _useState4 = useState(0),\n      cashBackPercent = _useState4[0],\n      setCashBackPercent = _useState4[1];\n\n  var _useState5 = useState(''),\n      cupom = _useState5[0],\n      setCupom = _useState5[1];\n\n  var _useCookies = useCookies(['user']),\n      _useCookies2 = _slicedToArray(_useCookies, 2),\n      cookie = _useCookies2[0],\n      setCookie = _useCookies2[1];\n\n  var _useState6 = useState(false),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var router = useRouter();\n\n  var cupomCheck = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              alert(cupom);\n              _context.next = 3;\n              return api.get(\"/cupom/\".concat(cupom)).then(function (response) {\n                var desconto = response.data.desconto;\n                setCashBackPercent(desconto);\n              })[\"catch\"](function (err) {\n                console.log(err);\n                alert('Cumpom inv√°lido');\n              });\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function cupomCheck() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleAddQuant = function handleAddQuant(position) {\n    var products = cart.products;\n    var total = 0; // console.log(products[position].quant)\n\n    products[position].quant = products[position].quant + 1;\n    products.map(function (product) {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products: products,\n      total: total\n    });\n  };\n\n  var handleSubQuant = function handleSubQuant(position) {\n    var products = cart.products;\n    var total = 0;\n\n    if (products[position].quant === 1) {\n      return;\n    }\n\n    products[position].quant = products[position].quant - 1;\n    products.map(function (product) {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products: products,\n      total: total\n    });\n  };\n\n  var shippingCalculate = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(cep.length < 8)) {\n                _context2.next = 3;\n                break;\n              }\n\n              alert('cep incompleto');\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              _context2.next = 5;\n              return api.post('/shipping/calculate', {\n                cep: cep,\n                products: products.map(function (product) {\n                  return {\n                    id: product.id,\n                    quant: product.quant\n                  };\n                })\n              }).then(function (response) {\n                var data = response.data;\n                var sedexShipping = data.find(function (option) {\n                  return option.name === 'SEDEX';\n                });\n                setShippingPrice(Number(sedexShipping.price) / 2);\n              })[\"catch\"](function (err) {\n                alert('algo deu errado, por favor tente novamente');\n                console.log(err);\n              });\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function shippingCalculate() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleDelete = function handleDelete(position) {\n    var total = 0.0;\n    var products = cart.products.filter(function (product) {\n      return product !== cart.products[position];\n    });\n    products.map(function (product) {\n      total = total + product.preco * product.quant;\n    });\n    setCart({\n      products: products,\n      total: total\n    });\n  };\n\n  var cashBackCalculate = function cashBackCalculate() {\n    var discount = total / 100 * cashBackPercent;\n    setCashBack(discount);\n  };\n\n  useEffect(function () {\n    cashBackCalculate();\n  }, [cashBackPercent, total]); // useEffect(() => {\n  //   setCart({\n  //     products: [],\n  //     total: 0\n  //   })\n  // }, [])\n\n  if (!products[0]) {\n    return /*#__PURE__*/_jsx(DefaultTemplate, {\n      categorias: categorias,\n      children: /*#__PURE__*/_jsx(PaddingWrapper, {\n        children: /*#__PURE__*/_jsxs(HorizontalPaddingWrapper, {\n          children: [/*#__PURE__*/_jsx(Heading, {\n            children: \"Seu carrinho est\\xE1 vazio!\"\n          }), /*#__PURE__*/_jsx(HorizontalPaddingWrapper, {\n            children: /*#__PURE__*/_jsx(Paragraph, {\n              textAlign: \"center\",\n              children: \"Parece que voc\\xEA n\\xE3o tem nada em seu carrinho, aqui est\\xE3o algumas sujest\\xF5es\"\n            })\n          }), /*#__PURE__*/_jsx(HorizontalPaddingWrapper, {\n            children: /*#__PURE__*/_jsx(GridWrapper, {\n              children: tier.map(function (product, index) {\n                return /*#__PURE__*/_jsx(ProductCard, {\n                  id: product.id,\n                  name: product.nome,\n                  image: server + product.cover.url,\n                  price: product.preco,\n                  slug: product.slug\n                }, index);\n              })\n            })\n          })]\n        })\n      })\n    });\n  }\n\n  var buy = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var order;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (cookie.token) {\n                _context3.next = 3;\n                break;\n              }\n\n              router.push('/login');\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              if (!(shippingPrice === 0)) {\n                _context3.next = 6;\n                break;\n              }\n\n              alert('por favor, insira seu cep e calcule seu frete');\n              return _context3.abrupt(\"return\");\n\n            case 6:\n              if (!isLoading) {\n                _context3.next = 8;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 8:\n              setIsLoading(true);\n              _context3.next = 11;\n              return api.post('/pedido', {\n                cep: cep,\n                cupom: cupom,\n                products: cart.products\n              }, {\n                headers: {\n                  Authorization: \"Bearer \".concat(cookie.token)\n                }\n              }).then(function (order) {\n                setCart({\n                  products: [],\n                  total: 0\n                });\n                setIsLoading(false);\n                router.push(order.data.url);\n              })[\"catch\"](function (err) {\n                alert('algo deu errado, por favor tente novamente');\n                setIsLoading(false);\n              });\n\n            case 11:\n              order = _context3.sent;\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function buy() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsx(DefaultTemplate, {\n    categorias: categorias,\n    children: /*#__PURE__*/_jsx(PaddingWrapper, {\n      children: /*#__PURE__*/_jsxs(HorizontalPaddingWrapper, {\n        children: [/*#__PURE__*/_jsx(Heading, {\n          margin: \"0 0 30px 0\",\n          children: \"MEU CARRINHO\"\n        }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.Main, {\n          children: [/*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.ShippingWrapper, {\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"header\",\n              children: [/*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"PRODUTO\"\n              }), /*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"QUANTIDADE\"\n              }), /*#__PURE__*/_jsx(\"h3\", {\n                className: \"title\",\n                children: \"PRE\\xC7O UNITARIO\"\n              })]\n            }), /*#__PURE__*/_jsx(\"br\", {}), products.map(function (product, index) {\n              return /*#__PURE__*/_jsxs(ShadowBox, {\n                className: \"shipping-box\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \"cell\",\n                  children: /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex variable\",\n                    children: [/*#__PURE__*/_jsx(Styles.ProductImage, {\n                      image: server + product.cover.url\n                    }), /*#__PURE__*/_jsxs(Styles.ProductData, {\n                      children: [/*#__PURE__*/_jsx(Styles.ProductName, {\n                        children: product.nome.toUpperCase()\n                      }), /*#__PURE__*/_jsxs(Styles.ProductReference, {\n                        children: [/*#__PURE__*/_jsx(\"b\", {\n                          children: \"refer\\xEAncia:\"\n                        }), \" \", product.slug]\n                      }), product.custom.isCustom && /*#__PURE__*/_jsxs(_Fragment, {\n                        children: [/*#__PURE__*/_jsxs(Styles.CustomName, {\n                          children: [/*#__PURE__*/_jsx(\"b\", {\n                            children: \"Nome:\"\n                          }), \" \", product.custom.name]\n                        }), /*#__PURE__*/_jsxs(Styles.CustomNumber, {\n                          children: [/*#__PURE__*/_jsx(\"b\", {\n                            children: \"N\\xFAmero:\"\n                          }), \" \", product.custom.number]\n                        })]\n                      }), /*#__PURE__*/_jsxs(Styles.CustomNumber, {\n                        children: [/*#__PURE__*/_jsx(\"b\", {\n                          children: \"Tamanho:\"\n                        }), \" \", product.size]\n                      }), /*#__PURE__*/_jsx(Styles.Favorite, {\n                        children: /*#__PURE__*/_jsx(FiHeart, {})\n                      })]\n                    })]\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"cell\",\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \"flex align-center\",\n                    children: /*#__PURE__*/_jsx(QuantController, {\n                      handleAdd: function handleAdd() {\n                        handleAddQuant(index);\n                      },\n                      handleSub: function handleSub() {\n                        handleSubQuant(index);\n                      },\n                      quant: product.quant\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"cell\",\n                  children: /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex align-center\",\n                    children: [/*#__PURE__*/_jsx(Styles.ProductPrice, {\n                      children: priceHandler.priceNumberToReadblePrice(product.preco)\n                    }), \"\\xA0 \\xA0\", /*#__PURE__*/_jsx(CgCloseR, {\n                      onClick: function onClick() {\n                        handleDelete(index);\n                      },\n                      color: \"red\",\n                      size: 20\n                    })]\n                  })\n                })]\n              }, index);\n            })]\n          }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(Styles.OrderResume, {\n            children: [/*#__PURE__*/_jsx(Heading, {\n              role: \"h4\",\n              lineBottom: false,\n              color: \"white100\",\n              children: \"RESUMO DO PEDIDO\"\n            }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"SUBTOTAL\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"main-price\",\n                children: priceHandler.priceNumberToReadblePrice(total)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"ENTREGA\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"shipping-price\",\n                children: shippingPrice === 0 ? 'Insira seu cep e calcule o envio' : priceHandler.priceNumberToReadblePrice(shippingPrice)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"DESCONTO\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"shipping-price\",\n                children: cashBack === 0 ? 'Insira seu cupom de desconto' : priceHandler.priceNumberToReadblePrice(cashBack)\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                className: \"subtitle\",\n                children: \"TOTAL\"\n              }), /*#__PURE__*/_jsx(\"span\", {\n                className: \"total\",\n                children: priceHandler.priceNumberToReadblePrice(total - cashBack + shippingPrice)\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"shipping-and-cupom\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"shipping\",\n              children: /*#__PURE__*/_jsx(ShadowBox, {\n                paddingX: \"xsmall\",\n                paddingY: \"medium\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"space-between-variable\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    children: [/*#__PURE__*/_jsx(\"h3\", {\n                      className: \"xxlarge semiBold\",\n                      children: \"CALCULE FRETE E PRAZO\"\n                    }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(Link, {\n                      href: \"http://www.buscacep.correios.com.br/sistemas/buscacep/buscaCepEndereco.cfm\",\n                      target: \"_blank\",\n                      fontSize: \"xlarge\",\n                      children: \"N\\xE3o sei meu cep\"\n                    })]\n                  }), \"\\xA0\", /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"start cep-input-wrapper\",\n                    children: [/*#__PURE__*/_jsx(Input, {\n                      value: cep,\n                      onChange: function onChange(e) {\n                        return setCep(cepMask(e.target.value));\n                      },\n                      height: 50,\n                      width: 200,\n                      maxLength: 8,\n                      placeholder: \"MEU CEP\"\n                    }), /*#__PURE__*/_jsx(Button, {\n                      fontSize: \"xlarge\",\n                      onClick: shippingCalculate,\n                      children: \"OK\"\n                    })]\n                  })]\n                })\n              })\n            }), \"\\xA0\", /*#__PURE__*/_jsxs(ShadowBox, {\n              className: \"cupom-wrapper\",\n              children: [/*#__PURE__*/_jsx(Heading, {\n                role: \"h4\",\n                fontSize: \"large\",\n                lineBottom: false,\n                children: \"CUPOM DE DESCONTO\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"cupom-input-wrapper\",\n                children: [/*#__PURE__*/_jsx(Input, {\n                  value: cupom,\n                  onChange: function onChange(e) {\n                    return setCupom(e.target.value);\n                  },\n                  placeholder: \"MEU CUPOM\"\n                }), ' ', /*#__PURE__*/_jsx(Button, {\n                  onClick: cupomCheck,\n                  children: \"OK\"\n                })]\n              })]\n            }), /*#__PURE__*/_jsx(Button, {\n              className: \"buy-button\",\n              fill: \"red100\",\n              radius: 10,\n              onClick: buy,\n              children: isLoading ? 'Processando...' : 'Finalizar compra'\n            })]\n          }), /*#__PURE__*/_jsx(Heading, {\n            role: \"h2\",\n            lineBottom: false,\n            fontSize: \"xxxlarge\",\n            margin: \"50px 0\",\n            fontWeight: \"bold\",\n            children: \"COMPRE TAMB\\xC9M\"\n          }), /*#__PURE__*/_jsx(GridWrapper, {\n            children: tier.map(function (product, index) {\n              return /*#__PURE__*/_jsx(ProductCard, {\n                id: product.id,\n                name: product.nome,\n                image: server + product.cover.url,\n                price: product.preco,\n                slug: product.slug\n              }, index);\n            })\n          })]\n        })]\n      })\n    })\n  });\n};\n\nexport var __N_SSG = true;\nexport default Carrinho;","map":null,"metadata":{},"sourceType":"module"}